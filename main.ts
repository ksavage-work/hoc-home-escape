namespace SpriteKind {
    export const DustBunny = SpriteKind.create()
    export const Fan = SpriteKind.create()
    export const BrokenAppliance = SpriteKind.create()
}
/**
 * functions to turn into blocks
 */
/**
 * GOAL --
 * 
 * while NEAR FAN
 * 
 *      fanBlowsAir
 */
/**
 * GOAL --
 * 
 * if (near sink) 
 * 
 *      fix sink
 * 
 * else if (near shower)
 * 
 *      fix shower
 * 
 * else if (near toilet)
 * 
 *      fix toilet
 */
function near_shower () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile17)) {
        showerIsFixed = true
    }
}
sprites.onOverlap(SpriteKind.Projectile, SpriteKind.DustBunny, function (sprite, otherSprite) {
    otherSprite.setVelocity(0, 50)
    sprite.destroy()
})
// testing
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile5)) {
        when_near_door()
        pickLock()
    } else if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile12)) {
        near_fan()
        while (fanOn) {
            fanBlowsAir()
        }
    } else if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile15)) {
        near_sink()
        fix_sink()
    } else if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile16)) {
        near_toilet()
        fix_toilet()
    } else if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile17)) {
        near_shower()
        fix_shower()
    } else {
        game.showLongText("failed", DialogLayout.Bottom)
    }
})
function fix_shower () {
    if (showerIsFixed) {
        for (let index = 0; index <= 6; index++) {
            tiles.setWallAt(tiles.getTileLocation(37, index + 2), false)
            tiles.setTileAt(tiles.getTileLocation(37, index + 2), sprites.dungeon.floorLight0)
            pause(200)
        }
    }
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.DustBunny, function (sprite, otherSprite) {
    dustBunny.startEffect(effects.clouds)
    game.showLongText("Too much dust!", DialogLayout.Bottom)
    pause(500)
    game.over(false)
})
/**
 * Challenges
 * 
 * rm1 - event
 * 
 * rm2 - loop
 * 
 * rm3 -
 */
// make more instructional
function challenge1 () {
    game.showLongText("Looks like someone locked the door. ", DialogLayout.Bottom)
    game.showLongText("Don't worry, you can pick the lock with code!", DialogLayout.Bottom)
    nearDoor = false
    talkedToBear = true
}
function near_sink () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile15)) {
        sinkIsFixed = true
    }
}
// interact with npc and other things
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile5)) {
        if (talkedToBear == false) {
            game.showLongText("Uh oh! It's locked!", DialogLayout.Bottom)
            game.showLongText("Talk to Bear for some help!", DialogLayout.Bottom)
        } else {
            game.showLongText("You'll need to unlock the door with code!", DialogLayout.Bottom)
        }
    } else if (thePlayer.tileKindAt(TileDirection.Top, myTiles.tile6)) {
        challenge1()
    } else if (thePlayer.tileKindAt(TileDirection.Top, myTiles.tile9)) {
        challenge2()
    } else if (thePlayer.tileKindAt(TileDirection.Left, myTiles.tile4)) {
        game.showLongText("The door won't budge!", DialogLayout.Bottom)
    } else if (thePlayer.tileKindAt(TileDirection.Bottom, myTiles.tile18)) {
        challenge3()
    } else {
    	
    }
})
function near_toilet () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile16)) {
        toiletIsFixed = true
    }
}
function when_near_door () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile5)) {
        nearDoor = true
    }
}
/**
 * GOAL --
 * 
 * when near door
 * 
 *     pickLock
 */
function pickLock () {
    // replace if with 'when near door'
    if (nearDoor) {
        tiles.setTileAt(tiles.getTileLocation(9, 5), myTiles.tile11)
        tiles.setWallAt(tiles.getTileLocation(9, 5), false)
    } else {
        game.showLongText("The door is still locked", DialogLayout.Bottom)
    }
}
function fix_sink () {
    if (sinkIsFixed) {
        for (let index = 0; index <= 6; index++) {
            tiles.setWallAt(tiles.getTileLocation(35, index + 2), false)
            tiles.setTileAt(tiles.getTileLocation(35, index + 2), sprites.dungeon.floorLight0)
            pause(200)
        }
    }
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile11, function (sprite, location) {
    tiles.placeOnTile(thePlayer, tiles.getTileLocation(17, 5))
    createDustBunnies()
})
function challenge3 () {
    game.showLongText("The sink, the toilet, and the shower are flooded!", DialogLayout.Bottom)
    game.showLongText("You'll have to fix each to stop the flooding.", DialogLayout.Bottom)
}
function fanBlowsAir () {
    if (fanOn) {
        fan = sprites.create(img`
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 
            `, SpriteKind.Fan)
        tiles.placeOnRandomTile(fan, myTiles.tile12)
        projectile = sprites.createProjectileFromSprite(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . 9 . . . . . . . . 
            . . . . . . . 9 . . . . . . . . 
            . . . . . 9 9 . . . . . . . . . 
            . . . . 9 9 . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . 9 . . 9 9 . . . . . . . . 
            . . . 9 . 9 9 9 9 . . . . . . . 
            . . . 9 . 9 . . 9 . 9 . . . . . 
            . . . 9 . . . 9 . . . 9 . . . . 
            . . . 9 9 9 9 9 . . . . 9 . . . 
            . . . . . . . . 9 9 . . 9 . . . 
            . . . . . . . 9 9 9 9 . 9 . . . 
            . . . . . . . 9 . . 9 . 9 9 . . 
            . . . . . . . 9 9 . . . 9 . . . 
            . . . . . . . . 9 9 9 9 9 . . . 
            `, fan, 0, 50)
    }
    pause(200)
}
function fix_toilet () {
    if (toiletIsFixed) {
        for (let index = 0; index <= 6; index++) {
            tiles.setWallAt(tiles.getTileLocation(36, 7 - index), false)
            tiles.setTileAt(tiles.getTileLocation(36, 7 - index), sprites.dungeon.floorLight0)
            pause(200)
        }
    }
}
function createDustBunnies () {
    for (let value of tiles.getTilesByType(myTiles.tile10)) {
        dustBunny = sprites.create(img`
            . . . c c . . . . . . . . . . . 
            . . . c 1 c . . . c c . . . . . 
            . . . . c 1 . . c 1 c . . . . . 
            . . . . . c 1 c 1 c . . . . . . 
            . . . 2 c b b 1 c c . . . . . . 
            . . . c b 2 b c b . . . . . . . 
            . . c b b b b c b b . . . . . . 
            . . b b b b b b c b b . . . . . 
            . . . . b c b b b b b . . . . . 
            . . . . b c c b b b b 1 1 . . . 
            . . . . b b b b b b b 1 1 . . . 
            . . . c b b c b b b b b . . . . 
            . . . c c b c c b b . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `, SpriteKind.DustBunny)
        tiles.placeOnTile(dustBunny, value)
        dustBunny.setVelocity(0, 50)
    }
    tiles.replaceAllTiles(myTiles.tile10, myTiles.tile1)
}
scene.onOverlapTile(SpriteKind.Player, myTiles.tile13, function (sprite, location) {
    tiles.placeOnTile(thePlayer, tiles.getTileLocation(33, 5))
    fanOn = false
    sinkIsFixed = false
    toiletIsFixed = false
    showerIsFixed = false
})
function near_fan () {
    if (thePlayer.tileKindAt(TileDirection.Right, myTiles.tile12) || (thePlayer.tileKindAt(TileDirection.Top, myTiles.tile12) || thePlayer.tileKindAt(TileDirection.Left, myTiles.tile12))) {
        fanOn = true
    }
}
// make more instructional
function challenge2 () {
    game.showLongText("Watch out! Some evil dust bunnies are blocking the door!", DialogLayout.Bottom)
    game.showLongText("If you run into them, you might choke on the dust.", DialogLayout.Bottom)
    game.showLongText("You'll need to defeat them before going to the next room.", DialogLayout.Bottom)
    fanOn = false
}
// add intro, instructions
let projectile: Sprite = null
let fan: Sprite = null
let toiletIsFixed = false
let sinkIsFixed = false
let talkedToBear = false
let nearDoor = false
let dustBunny: Sprite = null
let fanOn = false
let showerIsFixed = false
let thePlayer: Sprite = null
tiles.setTilemap(tiles.createTilemap(hex`40004000020202020202020202020000000000000202020202020202020200000000000002020202020202020202000000000000000000000000000000000000000000000201010101010501010200000000000002010105010101070102000000000000020d0d0b100e0d0d0d02000000000000000000000000000000000000000000000201010101010101010200000000000002010101010101060102000000000000020d0d1010100d0d0d02000000000000000000000000000000000000000000000201010101010101010200000000000002010101010101060102000000000000020d0d1010100d0d0d02000000000000000000000000000000000000000000000201030101010101010200000000000002010101010101060102000000000000020d0d1010100d0d0d0200000000000000000000000000000000000000000000020101010101010101040000000000000a0101010101010601080000000000000a0d0d1010100d0d0d09000000000000000000000000000000000000000000000201010101010101010200000000000002010101010101060102000000000000020d0d1010100d0d0d02000000000000000000000000000000000000000000000201010101010101010200000000000002010101010101060102000000000000020d0d1010100d0d0d02000000000000000000000000000000000000000000000201010101010101010200000000000002010101010101060102000000000000020f0d100c100d0d0d020000000000000000000000000000000000000000000002020202020202020202000000000000020202020202020202020000000000000202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000`, img`
    2222222222......2222222222......2222222222......................
    2.....2..2......2..2...2.2......2..222...2......................
    2........2......2........2......2..222...2......................
    2........2......2........2......2..222...2......................
    2........2......2........2......2..222...2......................
    2........2......2...............2..222..........................
    2........2......2........2......2..222...2......................
    2........2......2........2......2..222...2......................
    2........2......2........2......22.222...2......................
    2222222222......2222222222......2222222222......................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    `, [myTiles.transparency16,myTiles.tile1,myTiles.tile2,myTiles.tile3,myTiles.tile5,myTiles.tile6,myTiles.tile10,myTiles.tile12,myTiles.tile13,myTiles.tile14,myTiles.tile4,myTiles.tile15,myTiles.tile16,sprites.dungeon.floorLight0,myTiles.tile17,myTiles.tile18,myTiles.tile19], TileScale.Sixteen))
thePlayer = sprites.create(img`
    . . . . . . . . . . b 5 b . . . 
    . . . . . . . . . b 5 b . . . . 
    . . . . . . b b b b b b . . . . 
    . . . . . b b 5 5 5 5 5 b . . . 
    . . . . b b 5 d 1 f 5 5 d f . . 
    . . . . b 5 5 1 f f 5 d 4 c . . 
    . . . . b 5 5 d f b d d 4 4 . . 
    . b b b d 5 5 5 5 5 4 4 4 4 4 b 
    b d d d b b d 5 5 4 4 4 4 4 b . 
    b b d 5 5 5 b 5 5 5 5 5 5 b . . 
    c d c 5 5 5 5 d 5 5 5 5 5 5 b . 
    c b d c d 5 5 b 5 5 5 5 5 5 b . 
    . c d d c c b d 5 5 5 5 5 d b . 
    . . c b d d d d d 5 5 5 b b . . 
    . . . c c c c c c c c b b . . . 
    . . . . . . . . . . . . . . . . 
    `, SpriteKind.Player)
tiles.placeOnRandomTile(thePlayer, myTiles.tile3)
controller.moveSprite(thePlayer)
scene.cameraFollowSprite(thePlayer)
game.onUpdate(function () {
    for (let value of sprites.allOfKind(SpriteKind.DustBunny)) {
        if (value.isHittingTile(CollisionDirection.Top)) {
            value.vy = randint(30, 60)
        } else if (value.isHittingTile(CollisionDirection.Bottom)) {
            value.vy = randint(-30, -60)
        }
    }
})
